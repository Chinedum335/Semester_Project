<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 3 Phasing of Gene Copies into Polyploid Subgenomes | Cystopteridaceae Phylogeny Project</title>
  <meta name="description" content="<p>This is a minimal example of using the bookdown package to write a book.
The HTML output format for this example is bookdown::gitbook,
set in the _output.yml file.</p>" />
  <meta name="generator" content="bookdown 0.33 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 3 Phasing of Gene Copies into Polyploid Subgenomes | Cystopteridaceae Phylogeny Project" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="<p>This is a minimal example of using the bookdown package to write a book.
The HTML output format for this example is bookdown::gitbook,
set in the _output.yml file.</p>" />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 3 Phasing of Gene Copies into Polyploid Subgenomes | Cystopteridaceae Phylogeny Project" />
  
  <meta name="twitter:description" content="<p>This is a minimal example of using the bookdown package to write a book.
The HTML output format for this example is bookdown::gitbook,
set in the _output.yml file.</p>" />
  

<meta name="author" content="Chinedum Anajemba" />


<meta name="date" content="2023-04-30" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="database-design.html"/>
<link rel="next" href="phylogeny-design.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">A Minimal Book Example</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Overview</a></li>
<li class="chapter" data-level="1" data-path="data-assembly.html"><a href="data-assembly.html"><i class="fa fa-check"></i><b>1</b> Data Assembly</a></li>
<li class="chapter" data-level="2" data-path="database-design.html"><a href="database-design.html"><i class="fa fa-check"></i><b>2</b> Database design and architecture</a>
<ul>
<li class="chapter" data-level="2.1" data-path="database-design.html"><a href="database-design.html#building-the-database"><i class="fa fa-check"></i><b>2.1</b> Building the Database</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="database-design.html"><a href="database-design.html#establising-a-database-connection"><i class="fa fa-check"></i><b>2.1.1</b> Establising a database connection</a></li>
<li class="chapter" data-level="2.1.2" data-path="database-design.html"><a href="database-design.html#creating-the-sample_info-table-in-the-database"><i class="fa fa-check"></i><b>2.1.2</b> Creating the sample_info table in the database</a></li>
<li class="chapter" data-level="2.1.3" data-path="database-design.html"><a href="database-design.html#creating-the-phasing_stats_table-in-the-database"><i class="fa fa-check"></i><b>2.1.3</b> Creating the Phasing_stats_table in the database</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="phasing-design.html"><a href="phasing-design.html"><i class="fa fa-check"></i><b>3</b> Phasing of Gene Copies into Polyploid Subgenomes</a></li>
<li class="chapter" data-level="4" data-path="phylogeny-design.html"><a href="phylogeny-design.html"><i class="fa fa-check"></i><b>4</b> Visualizing the Phylogeny of Cystopteridaceae</a>
<ul>
<li class="chapter" data-level="4.1" data-path="phylogeny-design.html"><a href="phylogeny-design.html#summarizing-the-results-of-homologizer-analysis"><i class="fa fa-check"></i><b>4.1</b> Summarizing the Results of <code>homologizer</code> Analysis</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="phylogeny-design.html"><a href="phylogeny-design.html#convergence-assessment"><i class="fa fa-check"></i><b>4.1.1</b> Convergence Assessment</a></li>
<li class="chapter" data-level="4.1.2" data-path="phylogeny-design.html"><a href="phylogeny-design.html#summarizing-and-visiualizing-traces-of-specific-parameter"><i class="fa fa-check"></i><b>4.1.2</b> Summarizing and Visiualizing Traces of Specific Parameter</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="phylogeny-design.html"><a href="phylogeny-design.html#summarizing-homologizer-phasing-estimates-and-plotting-it-in-r"><i class="fa fa-check"></i><b>4.2</b> Summarizing <code>homologizer</code> Phasing Estimates and Plotting it in <code>R</code></a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Cystopteridaceae Phylogeny Project</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="phasing-design" class="section level1 hasAnchor" number="3">
<h1><span class="header-section-number">Chapter 3</span> Phasing of Gene Copies into Polyploid Subgenomes<a href="phasing-design.html#phasing-design" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>One of the main challenges to reconstructing a multi-locus phylogeny of clades with allopolyploid species is the phasing of gene copies into polyploid subgenomes. Allopolyploids contain distinct subgenomes each with their own evolutionary
history. When sequencing loci from such organisms, unique copies of each locus may be recovered from each subgenome and if each copy of each locus is not assigned to the correct subgenome,then multilocus phylogenetic inference can be erroneous and will lead to unsound results. <code>homologizer</code> is a Bayesian method that uses a phylogenetic framework to phase gene copies (i.e. assign sequence to the correct subgenome) across loci. In this chapter, we will discuss how to use <code>homologizer</code> to phase gene copies into polyploid subgenomes. <code>homologizer</code> is implemented in the open-source phylogenetic inference software <a href="http://revbayes.com">RevBayes</a>. RevBayes is a rich and complex phylogenetic inference tool that can accommodate a vast array of models. The RevBayes language is similar to the language used in R and it is designed to support interactive analysis. Extensive tutorials for Revbayes including how to download the software are available <a href="http://revbayes.com">here</a></p>
<p>In a <code>homologizer</code> analysis, phylogenies containing allopolyploid organisms are represented as multilabeled trees (“mul-trees”), where each hybrid accession is present multiple times, once for each subgenome (each distinct evolutionary history). The data used in this study consist of four single-copy nuclear loci (APP, GAP, IBR, and PGI) for a sample of 9 diploids and 2 tetraploids generated using PURC pipeline(see Chapter 1). A detailed instruction on how to prepare input file and run <code>homologizer</code> analysis can be found at <a href="http://github.com/wf8/homologizer">homologizer repository</a>. The script used for this analysis, <code>cystopteridaceae_homologizer</code> can be found <a href="https://github.com/Chinedum335/Semester_Project/tree/main/5_Code">here</a>. This script can be run within Revbayes by typing <code>source(cystopteridaceae_homologizer)</code> from the <a href="https://github.com/Chinedum335/Semester_Project/tree/main/5_Code">5_Code</a> directory. The code in <code>cystopteridaceae_homologizer</code> is shown below:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="phasing-design.html#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># This code Specifies a homologizer model that jointly infer the phase and phylogeny.</span></span>
<span id="cb5-2"><a href="phasing-design.html#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Run an MCMC analysis by default. Set bayes_factors = TRUE to calculate</span></span>
<span id="cb5-3"><a href="phasing-design.html#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co"># the marginal likelihood with a stepping stone analysis.</span></span>
<span id="cb5-4"><a href="phasing-design.html#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb5-5"><a href="phasing-design.html#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Will Freyman</span></span>
<span id="cb5-6"><a href="phasing-design.html#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb5-7"><a href="phasing-design.html#cb5-7" aria-hidden="true" tabindex="-1"></a>bayes_factors <span class="ot">=</span> <span class="cn">FALSE</span></span>
<span id="cb5-8"><a href="phasing-design.html#cb5-8" aria-hidden="true" tabindex="-1"></a>output_file <span class="ot">=</span> <span class="st">&quot;../4_Output_Trees/homologizer_output&quot;</span></span>
<span id="cb5-9"><a href="phasing-design.html#cb5-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-10"><a href="phasing-design.html#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="co"># input sequence alignments</span></span>
<span id="cb5-11"><a href="phasing-design.html#cb5-11" aria-hidden="true" tabindex="-1"></a>alignments <span class="ot">=</span> [<span class="st">&quot;../2_Processed_Data/APP.nex&quot;</span>,</span>
<span id="cb5-12"><a href="phasing-design.html#cb5-12" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;../2_Processed_Data/GAP.nex&quot;</span>,</span>
<span id="cb5-13"><a href="phasing-design.html#cb5-13" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;../2_Processed_Data/IBR.nex&quot;</span>,</span>
<span id="cb5-14"><a href="phasing-design.html#cb5-14" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;../2_Processed_Data/PGI.nex&quot;</span>]</span>
<span id="cb5-15"><a href="phasing-design.html#cb5-15" aria-hidden="true" tabindex="-1"></a>num_loci <span class="ot">=</span> <span class="fu">alignments.size</span>()</span>
<span id="cb5-16"><a href="phasing-design.html#cb5-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-17"><a href="phasing-design.html#cb5-17" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>num_loci) {</span>
<span id="cb5-18"><a href="phasing-design.html#cb5-18" aria-hidden="true" tabindex="-1"></a>    data[i] <span class="ot">=</span> <span class="fu">readDiscreteCharacterData</span>(alignments[i])</span>
<span id="cb5-19"><a href="phasing-design.html#cb5-19" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-20"><a href="phasing-design.html#cb5-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-21"><a href="phasing-design.html#cb5-21" aria-hidden="true" tabindex="-1"></a><span class="co"># add blank second IBR gene copy for C_tasmanica_6379</span></span>
<span id="cb5-22"><a href="phasing-design.html#cb5-22" aria-hidden="true" tabindex="-1"></a>data[<span class="dv">3</span>]<span class="fu">.addMissingTaxa</span>(<span class="st">&quot;6379_copy2&quot;</span>)</span>
<span id="cb5-23"><a href="phasing-design.html#cb5-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-24"><a href="phasing-design.html#cb5-24" aria-hidden="true" tabindex="-1"></a><span class="co"># set initial phase</span></span>
<span id="cb5-25"><a href="phasing-design.html#cb5-25" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>num_loci) {</span>
<span id="cb5-26"><a href="phasing-design.html#cb5-26" aria-hidden="true" tabindex="-1"></a>    data[i]<span class="fu">.setHomeologPhase</span>(<span class="st">&quot;6379_copy1&quot;</span>, <span class="st">&quot;C_tasmanica_6379_A&quot;</span>)</span>
<span id="cb5-27"><a href="phasing-design.html#cb5-27" aria-hidden="true" tabindex="-1"></a>    data[i]<span class="fu">.setHomeologPhase</span>(<span class="st">&quot;6379_copy2&quot;</span>, <span class="st">&quot;C_tasmanica_6379_B&quot;</span>)</span>
<span id="cb5-28"><a href="phasing-design.html#cb5-28" aria-hidden="true" tabindex="-1"></a>    data[i]<span class="fu">.setHomeologPhase</span>(<span class="st">&quot;7974_copy1&quot;</span>, <span class="st">&quot;xCystocarpium_7974_A&quot;</span>)</span>
<span id="cb5-29"><a href="phasing-design.html#cb5-29" aria-hidden="true" tabindex="-1"></a>    data[i]<span class="fu">.setHomeologPhase</span>(<span class="st">&quot;7974_copy2&quot;</span>, <span class="st">&quot;xCystocarpium_7974_B&quot;</span>)</span>
<span id="cb5-30"><a href="phasing-design.html#cb5-30" aria-hidden="true" tabindex="-1"></a>    data[i]<span class="fu">.setHomeologPhase</span>(<span class="st">&quot;7974_copy3&quot;</span>, <span class="st">&quot;xCystocarpium_7974_C&quot;</span>)</span>
<span id="cb5-31"><a href="phasing-design.html#cb5-31" aria-hidden="true" tabindex="-1"></a>    data[i]<span class="fu">.setHomeologPhase</span>(<span class="st">&quot;7974_copy4&quot;</span>, <span class="st">&quot;xCystocarpium_7974_D&quot;</span>)</span>
<span id="cb5-32"><a href="phasing-design.html#cb5-32" aria-hidden="true" tabindex="-1"></a>    <span class="co"># for the 3-tip phasing model uncomment these lines:</span></span>
<span id="cb5-33"><a href="phasing-design.html#cb5-33" aria-hidden="true" tabindex="-1"></a>    <span class="co">#data[i].addMissingTaxa(&quot;6379_BLANK3&quot;)</span></span>
<span id="cb5-34"><a href="phasing-design.html#cb5-34" aria-hidden="true" tabindex="-1"></a>    <span class="co">#data[i].setHomeologPhase(&quot;6379_BLANK3&quot;, &quot;C_tasmanica_6379_C&quot;)</span></span>
<span id="cb5-35"><a href="phasing-design.html#cb5-35" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-36"><a href="phasing-design.html#cb5-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-37"><a href="phasing-design.html#cb5-37" aria-hidden="true" tabindex="-1"></a><span class="co"># add missing taxa</span></span>
<span id="cb5-38"><a href="phasing-design.html#cb5-38" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>num_loci) {</span>
<span id="cb5-39"><a href="phasing-design.html#cb5-39" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>num_loci) {</span>
<span id="cb5-40"><a href="phasing-design.html#cb5-40" aria-hidden="true" tabindex="-1"></a>        data[i]<span class="fu">.addMissingTaxa</span>(data[j]<span class="fu">.taxa</span>())</span>
<span id="cb5-41"><a href="phasing-design.html#cb5-41" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb5-42"><a href="phasing-design.html#cb5-42" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-43"><a href="phasing-design.html#cb5-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-44"><a href="phasing-design.html#cb5-44" aria-hidden="true" tabindex="-1"></a>num_tips <span class="ot">=</span> data[<span class="dv">1</span>]<span class="fu">.ntaxa</span>()</span>
<span id="cb5-45"><a href="phasing-design.html#cb5-45" aria-hidden="true" tabindex="-1"></a>n_branches <span class="ot">=</span> <span class="dv">2</span> <span class="sc">*</span> num_tips <span class="sc">-</span> <span class="dv">3</span></span>
<span id="cb5-46"><a href="phasing-design.html#cb5-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-47"><a href="phasing-design.html#cb5-47" aria-hidden="true" tabindex="-1"></a><span class="co"># set up branches</span></span>
<span id="cb5-48"><a href="phasing-design.html#cb5-48" aria-hidden="true" tabindex="-1"></a>mvi <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb5-49"><a href="phasing-design.html#cb5-49" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_branches) {</span>
<span id="cb5-50"><a href="phasing-design.html#cb5-50" aria-hidden="true" tabindex="-1"></a>    branch_lengths[i] <span class="sc">~</span> <span class="fu">dnExponential</span>(<span class="dv">100</span>)</span>
<span id="cb5-51"><a href="phasing-design.html#cb5-51" aria-hidden="true" tabindex="-1"></a>    moves[<span class="sc">++</span>mvi] <span class="ot">=</span> <span class="fu">mvScale</span>(branch_lengths[i], <span class="at">weight=</span><span class="fl">1.0</span>)</span>
<span id="cb5-52"><a href="phasing-design.html#cb5-52" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-53"><a href="phasing-design.html#cb5-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-54"><a href="phasing-design.html#cb5-54" aria-hidden="true" tabindex="-1"></a><span class="co"># set up tree topology</span></span>
<span id="cb5-55"><a href="phasing-design.html#cb5-55" aria-hidden="true" tabindex="-1"></a>topology <span class="sc">~</span> <span class="fu">dnUniformTopology</span>(data[<span class="dv">1</span>]<span class="fu">.taxa</span>())</span>
<span id="cb5-56"><a href="phasing-design.html#cb5-56" aria-hidden="true" tabindex="-1"></a>moves[<span class="sc">++</span>mvi] <span class="ot">=</span> <span class="fu">mvNNI</span>(topology, <span class="at">weight=</span><span class="fl">40.0</span>)</span>
<span id="cb5-57"><a href="phasing-design.html#cb5-57" aria-hidden="true" tabindex="-1"></a>moves[<span class="sc">++</span>mvi] <span class="ot">=</span> <span class="fu">mvSPR</span>(topology, <span class="at">weight=</span><span class="fl">40.0</span>)</span>
<span id="cb5-58"><a href="phasing-design.html#cb5-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-59"><a href="phasing-design.html#cb5-59" aria-hidden="true" tabindex="-1"></a><span class="co"># combine branches and topology into tree</span></span>
<span id="cb5-60"><a href="phasing-design.html#cb5-60" aria-hidden="true" tabindex="-1"></a>tree <span class="sc">:</span><span class="er">=</span> <span class="fu">treeAssembly</span>(topology, branch_lengths)</span>
<span id="cb5-61"><a href="phasing-design.html#cb5-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-62"><a href="phasing-design.html#cb5-62" aria-hidden="true" tabindex="-1"></a><span class="co"># substitution models</span></span>
<span id="cb5-63"><a href="phasing-design.html#cb5-63" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>num_loci) {</span>
<span id="cb5-64"><a href="phasing-design.html#cb5-64" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-65"><a href="phasing-design.html#cb5-65" aria-hidden="true" tabindex="-1"></a>    <span class="co"># gtr for each locus</span></span>
<span id="cb5-66"><a href="phasing-design.html#cb5-66" aria-hidden="true" tabindex="-1"></a>    er_prior <span class="ot">&lt;-</span> <span class="fu">v</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>)</span>
<span id="cb5-67"><a href="phasing-design.html#cb5-67" aria-hidden="true" tabindex="-1"></a>    er[i] <span class="sc">~</span> <span class="fu">dnDirichlet</span>(er_prior)</span>
<span id="cb5-68"><a href="phasing-design.html#cb5-68" aria-hidden="true" tabindex="-1"></a>    er[i]<span class="fu">.setValue</span>(<span class="fu">simplex</span>(<span class="fu">v</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>)))</span>
<span id="cb5-69"><a href="phasing-design.html#cb5-69" aria-hidden="true" tabindex="-1"></a>    moves[<span class="sc">++</span>mvi] <span class="ot">=</span> <span class="fu">mvSimplexElementScale</span>(er[i], <span class="at">weight=</span><span class="dv">5</span>)</span>
<span id="cb5-70"><a href="phasing-design.html#cb5-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-71"><a href="phasing-design.html#cb5-71" aria-hidden="true" tabindex="-1"></a>    pi_prior <span class="ot">&lt;-</span> <span class="fu">v</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>)</span>
<span id="cb5-72"><a href="phasing-design.html#cb5-72" aria-hidden="true" tabindex="-1"></a>    pi[i] <span class="sc">~</span> <span class="fu">dnDirichlet</span>(pi_prior)</span>
<span id="cb5-73"><a href="phasing-design.html#cb5-73" aria-hidden="true" tabindex="-1"></a>    pi[i]<span class="fu">.setValue</span>(<span class="fu">simplex</span>(<span class="fu">v</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>)))</span>
<span id="cb5-74"><a href="phasing-design.html#cb5-74" aria-hidden="true" tabindex="-1"></a>    moves[<span class="sc">++</span>mvi] <span class="ot">=</span> <span class="fu">mvSimplexElementScale</span>(pi[i], <span class="at">weight=</span><span class="dv">5</span>)</span>
<span id="cb5-75"><a href="phasing-design.html#cb5-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-76"><a href="phasing-design.html#cb5-76" aria-hidden="true" tabindex="-1"></a>    Q[i] <span class="sc">:</span><span class="er">=</span> <span class="fu">fnGTR</span>(er[i], pi[i])</span>
<span id="cb5-77"><a href="phasing-design.html#cb5-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-78"><a href="phasing-design.html#cb5-78" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (i <span class="sc">==</span> <span class="dv">1</span>) {</span>
<span id="cb5-79"><a href="phasing-design.html#cb5-79" aria-hidden="true" tabindex="-1"></a>        rate_multiplier[i] <span class="ot">&lt;-</span> <span class="fl">1.0</span></span>
<span id="cb5-80"><a href="phasing-design.html#cb5-80" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb5-81"><a href="phasing-design.html#cb5-81" aria-hidden="true" tabindex="-1"></a>        rate_multiplier[i] <span class="sc">~</span> <span class="fu">dnExponential</span>(<span class="dv">1</span>)</span>
<span id="cb5-82"><a href="phasing-design.html#cb5-82" aria-hidden="true" tabindex="-1"></a>        moves[<span class="sc">++</span>mvi] <span class="ot">=</span> <span class="fu">mvScale</span>(rate_multiplier[i], <span class="at">weight=</span><span class="dv">5</span>)</span>
<span id="cb5-83"><a href="phasing-design.html#cb5-83" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb5-84"><a href="phasing-design.html#cb5-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-85"><a href="phasing-design.html#cb5-85" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-86"><a href="phasing-design.html#cb5-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-87"><a href="phasing-design.html#cb5-87" aria-hidden="true" tabindex="-1"></a><span class="co"># phylogenetic CTMC distributions for each locus</span></span>
<span id="cb5-88"><a href="phasing-design.html#cb5-88" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>num_loci) {</span>
<span id="cb5-89"><a href="phasing-design.html#cb5-89" aria-hidden="true" tabindex="-1"></a>    ctmc[i] <span class="sc">~</span> <span class="fu">dnPhyloCTMC</span>(<span class="at">tree=</span>tree, <span class="at">Q=</span>Q[i], <span class="at">branchRates=</span>rate_multiplier[i], <span class="at">type=</span><span class="st">&quot;DNA&quot;</span>)</span>
<span id="cb5-90"><a href="phasing-design.html#cb5-90" aria-hidden="true" tabindex="-1"></a>    ctmc[i]<span class="fu">.clamp</span>(data[i])  </span>
<span id="cb5-91"><a href="phasing-design.html#cb5-91" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-92"><a href="phasing-design.html#cb5-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-93"><a href="phasing-design.html#cb5-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-94"><a href="phasing-design.html#cb5-94" aria-hidden="true" tabindex="-1"></a><span class="co"># make phasing proposals</span></span>
<span id="cb5-95"><a href="phasing-design.html#cb5-95" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>) {</span>
<span id="cb5-96"><a href="phasing-design.html#cb5-96" aria-hidden="true" tabindex="-1"></a>    moves[<span class="sc">++</span>mvi] <span class="ot">=</span> <span class="fu">mvHomeologPhase</span>(ctmc[i], <span class="st">&quot;C_tasmanica_6379_A&quot;</span>, <span class="st">&quot;C_tasmanica_6379_B&quot;</span>, <span class="at">weight=</span><span class="dv">2</span>)</span>
<span id="cb5-97"><a href="phasing-design.html#cb5-97" aria-hidden="true" tabindex="-1"></a>    moves[<span class="sc">++</span>mvi] <span class="ot">=</span> <span class="fu">mvHomeologPhase</span>(ctmc[i], <span class="st">&quot;xCystocarpium_7974_A&quot;</span>, <span class="st">&quot;xCystocarpium_7974_B&quot;</span>, <span class="at">weight=</span><span class="dv">2</span>)</span>
<span id="cb5-98"><a href="phasing-design.html#cb5-98" aria-hidden="true" tabindex="-1"></a>    moves[<span class="sc">++</span>mvi] <span class="ot">=</span> <span class="fu">mvHomeologPhase</span>(ctmc[i], <span class="st">&quot;xCystocarpium_7974_A&quot;</span>, <span class="st">&quot;xCystocarpium_7974_C&quot;</span>, <span class="at">weight=</span><span class="dv">2</span>)</span>
<span id="cb5-99"><a href="phasing-design.html#cb5-99" aria-hidden="true" tabindex="-1"></a>    moves[<span class="sc">++</span>mvi] <span class="ot">=</span> <span class="fu">mvHomeologPhase</span>(ctmc[i], <span class="st">&quot;xCystocarpium_7974_A&quot;</span>, <span class="st">&quot;xCystocarpium_7974_D&quot;</span>, <span class="at">weight=</span><span class="dv">2</span>)</span>
<span id="cb5-100"><a href="phasing-design.html#cb5-100" aria-hidden="true" tabindex="-1"></a>    moves[<span class="sc">++</span>mvi] <span class="ot">=</span> <span class="fu">mvHomeologPhase</span>(ctmc[i], <span class="st">&quot;xCystocarpium_7974_B&quot;</span>, <span class="st">&quot;xCystocarpium_7974_C&quot;</span>, <span class="at">weight=</span><span class="dv">2</span>)</span>
<span id="cb5-101"><a href="phasing-design.html#cb5-101" aria-hidden="true" tabindex="-1"></a>    moves[<span class="sc">++</span>mvi] <span class="ot">=</span> <span class="fu">mvHomeologPhase</span>(ctmc[i], <span class="st">&quot;xCystocarpium_7974_B&quot;</span>, <span class="st">&quot;xCystocarpium_7974_D&quot;</span>, <span class="at">weight=</span><span class="dv">2</span>)</span>
<span id="cb5-102"><a href="phasing-design.html#cb5-102" aria-hidden="true" tabindex="-1"></a>    moves[<span class="sc">++</span>mvi] <span class="ot">=</span> <span class="fu">mvHomeologPhase</span>(ctmc[i], <span class="st">&quot;xCystocarpium_7974_C&quot;</span>, <span class="st">&quot;xCystocarpium_7974_D&quot;</span>, <span class="at">weight=</span><span class="dv">2</span>)</span>
<span id="cb5-103"><a href="phasing-design.html#cb5-103" aria-hidden="true" tabindex="-1"></a>    <span class="co"># for the 3-tip phasing model uncomment these lines:</span></span>
<span id="cb5-104"><a href="phasing-design.html#cb5-104" aria-hidden="true" tabindex="-1"></a>    <span class="co">#moves[++mvi] = mvHomeologPhase(ctmc[i], &quot;C_tasmanica_6379_A&quot;, &quot;C_tasmanica_6379_B&quot;, weight=2)</span></span>
<span id="cb5-105"><a href="phasing-design.html#cb5-105" aria-hidden="true" tabindex="-1"></a>    <span class="co">#moves[++mvi] = mvHomeologPhase(ctmc[i], &quot;C_tasmanica_6379_A&quot;, &quot;C_tasmanica_6379_C&quot;, weight=2)</span></span>
<span id="cb5-106"><a href="phasing-design.html#cb5-106" aria-hidden="true" tabindex="-1"></a>    <span class="co">#moves[++mvi] = mvHomeologPhase(ctmc[i], &quot;C_tasmanica_6379_B&quot;, &quot;C_tasmanica_6379_C&quot;, weight=2)</span></span>
<span id="cb5-107"><a href="phasing-design.html#cb5-107" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-108"><a href="phasing-design.html#cb5-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-109"><a href="phasing-design.html#cb5-109" aria-hidden="true" tabindex="-1"></a>mymodel <span class="ot">=</span> <span class="fu">model</span>(Q)</span>
<span id="cb5-110"><a href="phasing-design.html#cb5-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-111"><a href="phasing-design.html#cb5-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-112"><a href="phasing-design.html#cb5-112" aria-hidden="true" tabindex="-1"></a><span class="co"># set up monitors</span></span>
<span id="cb5-113"><a href="phasing-design.html#cb5-113" aria-hidden="true" tabindex="-1"></a>mni <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb5-114"><a href="phasing-design.html#cb5-114" aria-hidden="true" tabindex="-1"></a>monitors[<span class="sc">++</span>mni] <span class="ot">=</span> <span class="fu">mnModel</span>(<span class="at">filename=</span>output_file <span class="sc">+</span> <span class="st">&quot;.log&quot;</span>, <span class="at">printgen=</span><span class="dv">1</span>)</span>
<span id="cb5-115"><a href="phasing-design.html#cb5-115" aria-hidden="true" tabindex="-1"></a>monitors[<span class="sc">++</span>mni] <span class="ot">=</span> <span class="fu">mnFile</span>(<span class="at">filename=</span>output_file <span class="sc">+</span> <span class="st">&quot;.trees&quot;</span>, <span class="at">printgen=</span><span class="dv">1</span>, tree)</span>
<span id="cb5-116"><a href="phasing-design.html#cb5-116" aria-hidden="true" tabindex="-1"></a>monitors[<span class="sc">++</span>mni] <span class="ot">=</span> <span class="fu">mnScreen</span>(<span class="at">printgen=</span><span class="dv">1</span>)</span>
<span id="cb5-117"><a href="phasing-design.html#cb5-117" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>num_loci){</span>
<span id="cb5-118"><a href="phasing-design.html#cb5-118" aria-hidden="true" tabindex="-1"></a>    monitors[<span class="sc">++</span>mni] <span class="ot">=</span> <span class="fu">mnHomeologPhase</span>(<span class="at">filename=</span>output_file <span class="sc">+</span> <span class="st">&quot;_locus_&quot;</span> <span class="sc">+</span> i <span class="sc">+</span> <span class="st">&quot;_phase.log&quot;</span>, <span class="at">printgen=</span><span class="dv">1</span>, ctmc[i])</span>
<span id="cb5-119"><a href="phasing-design.html#cb5-119" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-120"><a href="phasing-design.html#cb5-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-121"><a href="phasing-design.html#cb5-121" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (bayes_factors) {</span>
<span id="cb5-122"><a href="phasing-design.html#cb5-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-123"><a href="phasing-design.html#cb5-123" aria-hidden="true" tabindex="-1"></a>    <span class="co"># running stepping stone analysis</span></span>
<span id="cb5-124"><a href="phasing-design.html#cb5-124" aria-hidden="true" tabindex="-1"></a>    pow_p <span class="ot">=</span> <span class="fu">powerPosterior</span>(mymodel, moves, monitors, output_file <span class="sc">+</span> <span class="st">&quot;.out&quot;</span>, <span class="at">cats=</span><span class="dv">50</span>, <span class="at">sampleFreq=</span><span class="dv">1</span>) </span>
<span id="cb5-125"><a href="phasing-design.html#cb5-125" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pow_p.burnin</span>(<span class="at">generations=</span><span class="dv">200</span>, <span class="at">tuningInterval=</span><span class="dv">50</span>)</span>
<span id="cb5-126"><a href="phasing-design.html#cb5-126" aria-hidden="true" tabindex="-1"></a>    <span class="co">#pow_p.run(generations=2000)  </span></span>
<span id="cb5-127"><a href="phasing-design.html#cb5-127" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pow_p.run</span>(<span class="at">generations=</span><span class="dv">1000</span>)  </span>
<span id="cb5-128"><a href="phasing-design.html#cb5-128" aria-hidden="true" tabindex="-1"></a>    ss <span class="ot">=</span> <span class="fu">steppingStoneSampler</span>(<span class="at">file=</span>output_file <span class="sc">+</span> <span class="st">&quot;.out&quot;</span>, <span class="at">powerColumnName=</span><span class="st">&quot;power&quot;</span>, <span class="at">likelihoodColumnName=</span><span class="st">&quot;likelihood&quot;</span>)</span>
<span id="cb5-129"><a href="phasing-design.html#cb5-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-130"><a href="phasing-design.html#cb5-130" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print the marginal likelihood to screen</span></span>
<span id="cb5-131"><a href="phasing-design.html#cb5-131" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(<span class="fu">ss.marginal</span>())</span>
<span id="cb5-132"><a href="phasing-design.html#cb5-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-133"><a href="phasing-design.html#cb5-133" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb5-134"><a href="phasing-design.html#cb5-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-135"><a href="phasing-design.html#cb5-135" aria-hidden="true" tabindex="-1"></a>    <span class="co"># run MCMC </span></span>
<span id="cb5-136"><a href="phasing-design.html#cb5-136" aria-hidden="true" tabindex="-1"></a>    mymcmc <span class="ot">=</span> <span class="fu">mcmc</span>(mymodel, monitors, moves)</span>
<span id="cb5-137"><a href="phasing-design.html#cb5-137" aria-hidden="true" tabindex="-1"></a>    <span class="co">#mymcmc.run(generations=10000)</span></span>
<span id="cb5-138"><a href="phasing-design.html#cb5-138" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mymcmc.run</span>(<span class="at">generations=</span><span class="dv">2000</span>)</span>
<span id="cb5-139"><a href="phasing-design.html#cb5-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-140"><a href="phasing-design.html#cb5-140" aria-hidden="true" tabindex="-1"></a>    <span class="co"># summarize results</span></span>
<span id="cb5-141"><a href="phasing-design.html#cb5-141" aria-hidden="true" tabindex="-1"></a>    treetrace <span class="ot">=</span> <span class="fu">readTreeTrace</span>(output_file <span class="sc">+</span> <span class="st">&quot;.trees&quot;</span>, <span class="at">treetype=</span><span class="st">&quot;non-clock&quot;</span>, <span class="at">burnin=</span><span class="fl">0.25</span>) </span>
<span id="cb5-142"><a href="phasing-design.html#cb5-142" aria-hidden="true" tabindex="-1"></a>    map_tree <span class="ot">=</span> <span class="fu">mapTree</span>(treetrace, output_file <span class="sc">+</span> <span class="st">&quot;_map.tree&quot;</span>)</span>
<span id="cb5-143"><a href="phasing-design.html#cb5-143" aria-hidden="true" tabindex="-1"></a>    mcc_tree <span class="ot">=</span> <span class="fu">mccTree</span>(treetrace, output_file <span class="sc">+</span> <span class="st">&quot;_mcc.tree&quot;</span>)</span>
<span id="cb5-144"><a href="phasing-design.html#cb5-144" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>When the analysis is complete, a <code>homologizer_output</code> folder that contains all of the files specified with the monitors will be created in the specified output folder</p>

</div>
            </section>

          </div>
        </div>
      </div>
<a href="database-design.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="phylogeny-design.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/USERNAME/REPO/edit/BRANCH/03-phasing.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf", "_main.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
